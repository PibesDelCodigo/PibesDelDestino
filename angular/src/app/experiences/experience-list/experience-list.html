<div class="reviews-container">
  
  <h5 class="mb-3">Opiniones de la Comunidad ({{ experiences.length }})</h5>

  <div class="card p-3 mb-3 bg-light border-0">
    <div class="row g-2">
      <div class="col-md-7">
        <input type="text" 
               class="form-control" 
               placeholder="Buscar..." 
               [(ngModel)]="searchText" 
               (keyup.enter)="loadExperiences()">
      </div>
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="filterType" (change)="loadExperiences()">
          <option [ngValue]="null">Todas</option>
          <option [ngValue]="0">Positivas</option>
          <option [ngValue]="1">Neutrales</option>
          <option [ngValue]="2">Negativas</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="button" class="btn btn-primary w-100" (click)="loadExperiences()">
          Filtrar
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="isLoading" class="text-center p-3">
    <div class="spinner-border text-primary" role="status"></div>
    <p>Cargando opiniones...</p>
  </div>

  <div *ngIf="!isLoading && experiences.length === 0" class="alert alert-info text-center">
    No se encontraron opiniones con estos filtros.
  </div>

  <div class="list-group" [hidden]="isLoading || experiences.length === 0">
    
    <div *ngFor="let exp of experiences" class="list-group-item position-relative">
      
      <div *ngIf="exp.userId === currentUserId" class="position-absolute top-0 end-0 m-2">
        
        <button class="btn btn-outline-primary btn-sm me-1" 
                (click)="editExperience(exp)" 
                title="Editar mi reseña">
            <i class="fa fa-pencil"></i>
        </button>

        <button class="btn btn-outline-danger btn-sm"
                (click)="delete(exp)"
                title="Eliminar mi reseña">
            <i class="fa fa-trash"></i>
        </button>
      </div>
      <div class="d-flex justify-content-between align-items-center me-5"> <div class="text-warning">
          <span *ngFor="let s of stars">
            <i [class]="s <= exp.rating ? 'fas fa-star' : 'far fa-star'"></i>
          </span>
          <span class="text-dark ms-2 fw-bold">({{ exp.rating }}/5)</span>
        </div>
        <small class="text-muted">{{ exp.date | date:'shortDate' }}</small>
      </div>

      <h6 class="fw-bold mt-2">{{ exp.title }}</h6>
      <p class="mb-1">{{ exp.description }}</p>
      
<small class="text-muted">
  <i class="fa fa-user-circle"></i> 
  
  <span class="text-primary fw-bold ms-1" 
        style="cursor: pointer; text-decoration: underline;"
        (click)="goToUserProfile(exp.userId, exp.userName)">
     {{ exp.userName || 'Usuario Anónimo' }}
  </span>
</small>
    </div>

  </div>
</div>