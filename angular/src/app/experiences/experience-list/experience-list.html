<div class="reviews-container">
  
  <h5 class="mb-3">Opiniones de la Comunidad ({{ experiences.length }})</h5>

  <div class="card p-3 mb-3 bg-light border-0">
    <div class="row g-2">
      <div class="col-md-7">
        <input type="text" 
               class="form-control" 
               placeholder="Buscar..." 
               [(ngModel)]="searchText" 
               (keyup.enter)="loadExperiences()">
      </div>
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="filterType" (change)="loadExperiences()">
          <option [ngValue]="null">Todas</option>
          <option [ngValue]="0">Positivas</option>
          <option [ngValue]="1">Neutrales</option>
          <option [ngValue]="2">Negativas</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="button" class="btn btn-primary w-100" (click)="loadExperiences()">
          Filtrar
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="isLoading" class="text-center p-3">
    <div class="spinner-border text-primary" role="status"></div>
    <p>Cargando opiniones...</p>
  </div>

  <div *ngIf="!isLoading && experiences.length === 0" class="alert alert-info text-center">
    No se encontraron opiniones con estos filtros.
  </div>

  <div class="list-group" [hidden]="isLoading || experiences.length === 0">
    
    <div *ngFor="let exp of experiences" class="list-group-item position-relative mb-2 shadow-sm border rounded">
      
      <div *ngIf="exp.userId === currentUserId" class="position-absolute top-0 end-0 m-2">
        <button class="btn btn-outline-primary btn-sm me-1" 
                (click)="editExperience(exp)" 
                title="Editar mi reseña">
            <i class="fa fa-pencil"></i>
        </button>

        <button class="btn btn-outline-danger btn-sm"
                (click)="delete(exp)"
                title="Eliminar mi reseña">
            <i class="fa fa-trash"></i>
        </button>
      </div>

      <div class="d-flex justify-content-between align-items-center me-5"> 
        <div class="text-warning">
          <span *ngFor="let s of stars">
            <i [class]="s <= exp.rating ? 'fas fa-star' : 'far fa-star'"></i>
          </span>
          <span class="text-dark ms-2 fw-bold">({{ exp.rating }}/5)</span>
        </div>
        <small class="text-muted">{{ exp.date | date:'shortDate' }}</small>
      </div>

      <h6 class="fw-bold mt-2">{{ exp.title }}</h6>
      <p class="mb-1">{{ exp.description }}</p>
      
      <div class="mb-2 mt-1">
        
        <button *ngIf="!translatedTexts[exp.id]" 
                class="btn btn-link p-0 text-decoration-none small"
                style="font-size: 0.85rem;"
                (click)="translate(exp.id, exp.description)"
                [disabled]="isTranslating[exp.id]">
          
          <span *ngIf="!isTranslating[exp.id]">
             <i class="fa fa-language text-primary"></i> Traducir al Inglés
          </span>
          
          <span *ngIf="isTranslating[exp.id]">
             <i class="fa fa-spinner fa-spin text-secondary"></i> Traduciendo...
          </span>
        </button>

        <div *ngIf="translatedTexts[exp.id]" class="p-2 bg-light rounded border mt-1">
          <small class="text-muted d-block fw-bold mb-1" style="font-size: 0.75rem;">
            <i class="fa fa-check-circle text-success"></i> Traducción (API Externa):
          </small>
          <p class="mb-0 fst-italic text-dark small">{{ translatedTexts[exp.id] }}</p>
        </div>

      </div>
      <small class="text-muted">
        <i class="fa fa-user-circle"></i> 
        
        <span class="text-primary fw-bold ms-1" 
              style="cursor: pointer; text-decoration: underline;"
              (click)="goToUserProfile(exp.userId, exp.userName)">
           {{ exp.userName || 'Usuario Anónimo' }}
        </span>
      </small>

    </div>

  </div>
</div>