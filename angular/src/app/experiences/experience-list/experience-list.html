<div class="reviews-section">
  
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
    <div class="d-flex align-items-center">
      <h3 class="fw-bold mb-0 text-dark">Opiniones de la Comunidad</h3>
      <span class="badge bg-light text-dark rounded-pill border ms-3 px-3">{{ experiences.length }}</span>
    </div>

    <button *ngIf="!hasAlreadyReviewed" 
            class="btn btn-primary rounded-pill px-4 py-2 fw-bold shadow-sm d-flex align-items-center gap-2 animate-bounce" 
            (click)="createExperience()">
      <i class="fas fa-pen-nib"></i> 
      <span>Escribir mi Rese√±a</span>
    </button>

    <div *ngIf="hasAlreadyReviewed" class="text-success fw-bold small bg-light px-3 py-2 rounded-pill border">
      <i class="fas fa-check-circle me-1"></i> Ya compartiste tu opini√≥n sobre este destino
    </div>
  </div>

  <div class="filter-bar d-flex gap-3 mb-4 p-3 bg-white rounded-3 shadow-sm border">
      <div class="input-group search-box flex-grow-1">
        <span class="input-group-text bg-transparent border-end-0"><i class="fas fa-search text-muted"></i></span>
        <input type="text" class="form-control border-start-0 ps-0 bg-transparent" placeholder="Buscar comentarios..." 
               [(ngModel)]="searchText" (keyup.enter)="loadExperiences()">
      </div>
      
      <select class="form-select w-auto border-0 bg-light fw-bold text-secondary" [(ngModel)]="filterType" (change)="loadExperiences()">
        <option [ngValue]="null">Todas las notas</option>
        <option [ngValue]="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excelentes</option>
        <option [ngValue]="0">üëç Positivas</option>
        <option [ngValue]="2">üëé Negativas</option>
      </select>
  </div>

  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-grow text-primary" role="status"></div>
    <p class="mt-2 text-muted small">Buscando experiencias...</p>
  </div>

  <div *ngIf="!isLoading && experiences.length === 0" class="text-center py-5 bg-light rounded-3 border-dashed">
    <div class="mb-3 text-muted opacity-50"><i class="far fa-comment-dots fa-4x"></i></div>
    <h5 class="fw-bold text-dark">Nadie ha comentado todav√≠a</h5>
    <p class="text-muted">¬°Animate y s√© el primero en contar qu√© te pareci√≥!</p>
    <button *ngIf="!hasAlreadyReviewed" class="btn btn-outline-primary btn-sm rounded-pill mt-2" (click)="createExperience()">Escribir ahora</button>
  </div>

  <div class="reviews-grid" *ngIf="!isLoading && experiences.length > 0">
    <div *ngFor="let exp of experiences" class="review-card card border-0 shadow-sm mb-3">
      <div class="card-body p-4">
        
        <div class="d-flex justify-content-between align-items-start mb-3">
          <div class="d-flex align-items-center cursor-pointer" (click)="goToUserProfile(exp.userId, exp.userName)">
            <div class="user-avatar shadow-sm" [style.backgroundColor]="getAvatarColor(exp.userName)">
              {{ (exp.userName || 'A').charAt(0).toUpperCase() }}
            </div>
            <div class="ms-3">
              <h6 class="fw-bold mb-0 text-dark">{{ exp.userName || 'Viajero de Pibes del Destino' }}</h6>
              <small class="text-muted">{{ exp.date | date:'mediumDate' }}</small>
            </div>
          </div>

          <div *ngIf="exp.userId === currentUserId">
            <button 
              class="btn btn-outline-primary btn-sm rounded-pill px-3 d-flex align-items-center gap-2 shadow-sm transition-transform" 
              (click)="editExperience(exp)" 
              title="Editar mi rese√±a">
              <i class="fas fa-pencil-alt"></i>
              <span class="small fw-bold">Editar</span>
            </button>
          </div>
        </div>

        <div class="review-rating mb-2">
          <i *ngFor="let s of [1,2,3,4,5]" 
             [class]="s <= exp.rating ? 'fas fa-star text-warning' : 'far fa-star text-muted star-placeholder'">
          </i>
        </div>

        <h5 class="fw-bold text-dark mb-2">{{ exp.title }}</h5>
        <p class="text-secondary review-text">{{ exp.description }}</p>

        <div class="translation-area mt-3">
          <button *ngIf="!translatedTexts[exp.id]" class="btn-translate"
                  (click)="translate(exp.id, exp.description)" [disabled]="isTranslating[exp.id]">
            <i class="fas fa-globe-americas me-1"></i>
            <span *ngIf="!isTranslating[exp.id]">Ver traducci√≥n (EN)</span>
            <span *ngIf="isTranslating[exp.id]">Traduciendo...</span>
          </button>
          
          <div *ngIf="translatedTexts[exp.id]" class="translated-box animate-fade-in p-3 bg-light rounded-3 border-start border-primary border-4">
            <div class="d-flex align-items-center mb-1">
              <i class="fas fa-language text-primary me-2"></i>
              <small class="fw-bold text-primary">English Translation</small>
            </div>
            <p class="mb-0 text-dark fst-italic">{{ translatedTexts[exp.id] }}</p>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>